[2025-11-10 19:31:41] [INFO] - [Seed] Global seed fixed to 42.
[2025-11-10 19:31:41] [INFO] - [Main] /home/miyata/copy_Kuroki/DualB-FedLoRA/resnet/../config.yml から設定をロードしました。
[2025-11-10 19:31:41] [INFO] - Loaded config:
{
  "experiment_name": "01",
  "num_clients": 5,
  "num_rounds": 50,
  "local_epochs": 2,
  "non_iid_alpha": 0.1,
  "eval_interval": 1,
  "seed": 42,
  "rank": 4,
  "image_size": 64,
  "lora_target_modules": [
    "mlp",
    "head"
  ],
  "client_lr": 0.01,
  "server_lr": 0.1,
  "spsa_eta_b": 0.0001,
  "spsa_epsilon": 0.1,
  "server_momentum": 0.9,
  "shapley_tmc_iterations": 20,
  "proxy_validation_type": "g_A"
}
[2025-11-10 19:31:41] [INFO] - 
[Main] Using device: cuda
[2025-11-10 19:31:41] [INFO] - 
[Main] 共通データセットを準備します...
[2025-11-10 19:31:41] [INFO] - [Main] 入力解像度を 64x64 に設定します。
[2025-11-10 19:31:42] [INFO] - [Data] Non-IIDデータ分割を開始 (Alpha=0.1)...
[2025-11-10 19:31:42] [INFO] - [Data] 5 クライアント分のデータローダーを作成完了。
[2025-11-10 19:31:42] [INFO] - [Main] テストローダーのバッチサイズ: 64
[2025-11-10 19:31:42] [INFO] - --- [パート1] B-Fixed (ResNet) 版 ---
[2025-11-10 19:31:42] [INFO] - Clients: 5, Rounds: 50, Rank: 4
[2025-11-10 19:31:42] [INFO] - ------------------------------
[2025-11-10 19:31:42] [INFO] - [Model] ResNet-50 (ImageNet-1k) をロード中...
[2025-11-10 19:31:43] [INFO] - [Model] ResNet-50ロード完了。分類ヘッド (Linear 2048->10) をLoRA化 (Rank=4)。
[2025-11-10 19:31:43] [INFO] - [Server] B_server を直交行列 (shape 10x4) で初期化しました。
[2025-11-10 19:31:43] [INFO] - [Server] B-Fixed (ResNet) サーバを初期化しました。
[2025-11-10 19:31:43] [INFO] - [Main] Client LR: 0.01
[2025-11-10 19:31:43] [INFO] - [Main] 5 クライアントの初期化完了。
[2025-11-10 19:31:43] [INFO] - ------------------------------
[2025-11-10 19:31:43] [INFO] - [Main] グローバルテスト精度を 1 ラウンドごとに計算します。
[2025-11-10 19:31:43] [INFO] - 
--- Round 1/50 ---
[2025-11-10 19:32:09] [INFO] -   [Client 0] Local Train (A & B_client): Avg Loss = 0.6192
[2025-11-10 19:32:33] [INFO] -   [Client 1] Local Train (A & B_client): Avg Loss = 0.7444
[2025-11-10 19:32:40] [INFO] -   [Client 2] Local Train (A & B_client): Avg Loss = 0.5469
[2025-11-10 19:33:01] [INFO] -   [Client 3] Local Train (A & B_client): Avg Loss = 0.8203
[2025-11-10 19:33:06] [INFO] -   [Client 4] Local Train (A & B_client): Avg Loss = 0.6482
[2025-11-10 19:33:06] [INFO] -          [Server] B_server は固定されているため、更新をスキップします。
[2025-11-10 19:33:06] [INFO] - 
[Server] Shapley値 (TMC) の計算を開始...
[2025-11-10 19:33:06] [INFO] -            [Shapley] TMC-Shapley (T=20) 開始...
[2025-11-10 19:33:08] [INFO] -            [Shapley] V(S=[3]) = -2.6599 (=-loss)
[2025-11-10 19:33:11] [INFO] -            [Shapley] V(S=[1, 3]) = -2.1228 (=-loss)
[2025-11-10 19:33:13] [INFO] -            [Shapley] V(S=[1, 2, 3]) = -2.5842 (=-loss)
[2025-11-10 19:33:16] [INFO] -            [Shapley] V(S=[1, 2, 3, 4]) = -2.3354 (=-loss)
[2025-11-10 19:33:18] [INFO] -            [Shapley] V(S=[0, 1, 2, 3, 4]) = -1.7156 (=-loss)
[2025-11-10 19:33:20] [INFO] -            [Shapley] V(S=[4]) = -5.8931 (=-loss)
[2025-11-10 19:33:23] [INFO] -            [Shapley] V(S=[2, 4]) = -3.6324 (=-loss)
[2025-11-10 19:33:25] [INFO] -            [Shapley] V(S=[2, 3, 4]) = -2.6212 (=-loss)
[2025-11-10 19:33:27] [INFO] -            [Shapley] V(S=[0, 2, 3, 4]) = -1.7760 (=-loss)
[2025-11-10 19:33:30] [INFO] -            [Shapley] V(S=[0]) = -4.9763 (=-loss)
[2025-11-10 19:33:32] [INFO] -            [Shapley] V(S=[0, 2]) = -2.1384 (=-loss)
[2025-11-10 19:33:34] [INFO] -            [Shapley] V(S=[0, 2, 3]) = -1.7785 (=-loss)
[2025-11-10 19:33:37] [INFO] -            [Shapley] V(S=[2]) = -5.1944 (=-loss)
[2025-11-10 19:33:38] [INFO] -            [Shapley] V(S=[2, 3]) = -3.0460 (=-loss)
[2025-11-10 19:33:40] [INFO] -            [Shapley] V(S=[0, 1]) = -3.4326 (=-loss)
[2025-11-10 19:33:43] [INFO] -            [Shapley] V(S=[0, 1, 4]) = -2.4769 (=-loss)
[2025-11-10 19:33:45] [INFO] -            [Shapley] V(S=[0, 1, 2, 4]) = -2.1952 (=-loss)
[2025-11-10 19:33:47] [INFO] -            [Shapley] V(S=[1, 4]) = -3.7629 (=-loss)
[2025-11-10 19:33:49] [INFO] -            [Shapley] V(S=[1]) = -5.7769 (=-loss)
[2025-11-10 19:33:52] [INFO] -            [Shapley] V(S=[1, 2]) = -4.1949 (=-loss)
[2025-11-10 19:33:54] [INFO] -            [Shapley] V(S=[1, 2, 4]) = -3.2578 (=-loss)
[2025-11-10 19:33:56] [INFO] -            [Shapley] V(S=[0, 4]) = -2.9416 (=-loss)
[2025-11-10 19:33:59] [INFO] -            [Shapley] V(S=[0, 3, 4]) = -2.0261 (=-loss)
[2025-11-10 19:34:01] [INFO] -            [Shapley] V(S=[1, 3, 4]) = -2.1642 (=-loss)
[2025-11-10 19:34:04] [INFO] -            [Shapley] V(S=[0, 1, 3, 4]) = -1.7063 (=-loss)
[2025-11-10 19:34:06] [INFO] -            [Shapley] V(S=[0, 3]) = -2.1397 (=-loss)
[2025-11-10 19:34:08] [INFO] -            [Shapley] V(S=[0, 1, 3]) = -1.8702 (=-loss)
[2025-11-10 19:34:10] [INFO] -            [Shapley] V(S=[0, 2, 4]) = -2.0196 (=-loss)
[2025-11-10 19:34:10] [INFO] - [Server] Shapley Values (TMC) 算出完了:
[2025-11-10 19:34:10] [INFO] -          Client 0: phi = 0.5396
[2025-11-10 19:34:10] [INFO] -          Client 1: phi = 1.0267
[2025-11-10 19:34:10] [INFO] -          Client 2: phi = 0.2658
[2025-11-10 19:34:10] [INFO] -          Client 3: phi = -0.6459
[2025-11-10 19:34:10] [INFO] -          Client 4: phi = 0.5354
[2025-11-10 19:34:10] [INFO] - [Server] Hybrid Weights (Shapley × Cos): {0: 0.008833070820851533, 1: 0.4303109098781283, 2: 0.1730502087517139, 3: 0.0, 4: 0.3878058105482215}
[2025-11-10 19:34:10] [INFO] - [Server] Spearman(Phi,Cos) = -0.5000 (p=0.3910)
[2025-11-10 19:34:10] [INFO] - [Server] Hybrid Shapley×Cos aggregation applied to A.
[2025-11-10 19:34:10] [INFO] - 
[Main] Round 1: グローバルテスト精度を計算中...
[2025-11-10 19:34:13] [INFO] - ====== [Main] Round 1 Global Test Accuracy: 24.0000% ======
[2025-11-10 19:34:13] [INFO] - 
--- Round 2/50 ---
[2025-11-10 19:34:31] [INFO] -   [Client 0] Local Train (A & B_client): Avg Loss = 0.4384
[2025-11-10 19:34:51] [INFO] -   [Client 1] Local Train (A & B_client): Avg Loss = 0.4821
[2025-11-10 19:34:58] [INFO] -   [Client 2] Local Train (A & B_client): Avg Loss = 0.2757
[2025-11-10 19:35:18] [INFO] -   [Client 3] Local Train (A & B_client): Avg Loss = 0.5732
[2025-11-10 19:35:24] [INFO] -   [Client 4] Local Train (A & B_client): Avg Loss = 0.3947
[2025-11-10 19:35:24] [INFO] -          [Server] B_server は固定されているため、更新をスキップします。
[2025-11-10 19:35:24] [INFO] - 
[Server] Shapley値 (TMC) の計算を開始...
[2025-11-10 19:35:24] [INFO] -            [Shapley] TMC-Shapley (T=20) 開始...
[2025-11-10 19:35:26] [INFO] -            [Shapley] V(S=[0]) = -4.8674 (=-loss)
[2025-11-10 19:35:29] [INFO] -            [Shapley] V(S=[0, 3]) = -2.0036 (=-loss)
[2025-11-10 19:35:31] [INFO] -            [Shapley] V(S=[0, 2, 3]) = -1.8554 (=-loss)
[2025-11-10 19:35:33] [INFO] -            [Shapley] V(S=[0, 1, 2, 3]) = -1.9954 (=-loss)
[2025-11-10 19:35:36] [INFO] -            [Shapley] V(S=[0, 1, 2, 3, 4]) = -1.7110 (=-loss)
[2025-11-10 19:35:39] [INFO] -            [Shapley] V(S=[2]) = -5.8165 (=-loss)
[2025-11-10 19:35:41] [INFO] -            [Shapley] V(S=[1, 2]) = -4.4987 (=-loss)
[2025-11-10 19:35:43] [INFO] -            [Shapley] V(S=[1, 2, 4]) = -3.2451 (=-loss)
[2025-11-10 19:35:45] [INFO] -            [Shapley] V(S=[1, 2, 3, 4]) = -2.3156 (=-loss)
[2025-11-10 19:35:48] [INFO] -            [Shapley] V(S=[1]) = -5.9265 (=-loss)
[2025-11-10 19:35:50] [INFO] -            [Shapley] V(S=[0, 1]) = -3.5742 (=-loss)
[2025-11-10 19:35:53] [INFO] -            [Shapley] V(S=[0, 1, 2]) = -2.9228 (=-loss)
[2025-11-10 19:35:56] [INFO] -            [Shapley] V(S=[0, 1, 2, 4]) = -2.2080 (=-loss)
[2025-11-10 19:35:59] [INFO] -            [Shapley] V(S=[4]) = -6.1204 (=-loss)
[2025-11-10 19:36:02] [INFO] -            [Shapley] V(S=[0, 4]) = -2.9853 (=-loss)
[2025-11-10 19:36:06] [INFO] -            [Shapley] V(S=[0, 1, 4]) = -2.4898 (=-loss)
[2025-11-10 19:36:09] [INFO] -            [Shapley] V(S=[0, 1, 3, 4]) = -1.6639 (=-loss)
[2025-11-10 19:36:12] [INFO] -            [Shapley] V(S=[1, 3]) = -2.1691 (=-loss)
[2025-11-10 19:36:15] [INFO] -            [Shapley] V(S=[1, 3, 4]) = -2.0876 (=-loss)
[2025-11-10 19:36:18] [INFO] -            [Shapley] V(S=[0, 2]) = -2.2883 (=-loss)
[2025-11-10 19:36:22] [INFO] -            [Shapley] V(S=[1, 2, 3]) = -2.7818 (=-loss)
[2025-11-10 19:36:25] [INFO] -            [Shapley] V(S=[0, 2, 3, 4]) = -1.6768 (=-loss)
[2025-11-10 19:36:28] [INFO] -            [Shapley] V(S=[0, 3, 4]) = -1.9160 (=-loss)
[2025-11-10 19:36:31] [INFO] -            [Shapley] V(S=[2, 4]) = -3.5749 (=-loss)
[2025-11-10 19:36:34] [INFO] -            [Shapley] V(S=[0, 2, 4]) = -1.9178 (=-loss)
[2025-11-10 19:36:37] [INFO] -            [Shapley] V(S=[1, 4]) = -3.7047 (=-loss)
[2025-11-10 19:36:39] [INFO] -            [Shapley] V(S=[3]) = -2.5652 (=-loss)
[2025-11-10 19:36:42] [INFO] -            [Shapley] V(S=[2, 3]) = -3.3097 (=-loss)
[2025-11-10 19:36:44] [INFO] -            [Shapley] V(S=[3, 4]) = -2.7815 (=-loss)
[2025-11-10 19:36:44] [INFO] - [Server] Shapley Values (TMC) 算出完了:
[2025-11-10 19:36:44] [INFO] -          Client 0: phi = -0.4208
[2025-11-10 19:36:44] [INFO] -          Client 1: phi = 1.9129
[2025-11-10 19:36:44] [INFO] -          Client 2: phi = 0.2557
[2025-11-10 19:36:44] [INFO] -          Client 3: phi = -1.1326
[2025-11-10 19:36:44] [INFO] -          Client 4: phi = 1.0958
[2025-11-10 19:36:44] [INFO] - [Server] Hybrid Weights (Shapley × Cos): {0: 0.0, 1: 0.4578761471973968, 2: 0.0942865147263514, 3: 0.0, 4: 0.44783733807563736}
[2025-11-10 19:36:44] [INFO] - [Server] Spearman(Phi,Cos) = 0.2000 (p=0.7471)
[2025-11-10 19:36:44] [INFO] - [Server] Hybrid Shapley×Cos aggregation applied to A.
[2025-11-10 19:36:44] [INFO] - 
[Main] Round 2: グローバルテスト精度を計算中...
[2025-11-10 19:36:47] [INFO] - ====== [Main] Round 2 Global Test Accuracy: 24.9100% ======
[2025-11-10 19:36:47] [INFO] - 
--- Round 3/50 ---
[2025-11-10 19:37:09] [INFO] -   [Client 0] Local Train (A & B_client): Avg Loss = 0.3966
[2025-11-10 19:37:34] [INFO] -   [Client 1] Local Train (A & B_client): Avg Loss = 0.4512
[2025-11-10 19:37:43] [INFO] -   [Client 2] Local Train (A & B_client): Avg Loss = 0.2346
[2025-11-10 19:38:07] [INFO] -   [Client 3] Local Train (A & B_client): Avg Loss = 0.5204
[2025-11-10 19:38:14] [INFO] -   [Client 4] Local Train (A & B_client): Avg Loss = 0.3357
[2025-11-10 19:38:14] [INFO] -          [Server] B_server は固定されているため、更新をスキップします。
[2025-11-10 19:38:14] [INFO] - 
[Server] Shapley値 (TMC) の計算を開始...
[2025-11-10 19:38:14] [INFO] -            [Shapley] TMC-Shapley (T=20) 開始...
[2025-11-10 19:38:17] [INFO] -            [Shapley] V(S=[2]) = -6.0703 (=-loss)
[2025-11-10 19:38:19] [INFO] -            [Shapley] V(S=[1, 2]) = -4.5918 (=-loss)
[2025-11-10 19:38:21] [INFO] -            [Shapley] V(S=[1, 2, 3]) = -2.8690 (=-loss)
